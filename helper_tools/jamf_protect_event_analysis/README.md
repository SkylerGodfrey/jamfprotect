# Jamf Protect Event Analysis

Resources contained within this repository can be leveraged in order to help you start troubleshooting in case performance issues on a macOS endpoint have been reported.
Jamf Protect does monitor process, file and many other events, in some cases Jamf Protect may monitor events that generate many process or file events in high volumes, it may help to investigate which applications generate these events and if these applications are familiar within the organisation then they could be added into a [Exception Set](https://docs.jamf.com/jamf-protect/documentation/Exceptions.html) within Jamf Protect to improve the performance on a macOS endpoint.

The output generated by the provided python script can be used in order to start building exception sets based on the top 10s provided in the output.  

The script currently supports the following monitors: 

* Threat Feed
* Process
* File
* Unified Logging

```
❯ source ~/Documents/py3-jp/bin/activate
py3-jp ❯ ./jp_event_analysis.py -m Process -s
Running Process log stream for the next 60 seconds...
Top 10 Count for Process Monitor
 count    pid                            parent                              args
     3  37251                  Parent Process 1                         Arguments
     2  37738                  Parent Process 2                         Arguments
     1  37590                  Parent Process 3                         Arguments

Unique Codesigning Info
                                             Binary                  Signing Info
  /Applications/Parent Process 1.app/Contents/MacO...                  XXXXXXXXXX
  /Users/username/Library/Application Support/Proc...                  XXXXXXXXXX
  /Applications/Parent Process 3.app/Contents/MacO...         com.company.process

See excel spreadsheet for full report.
```

## Requirements

- [x] Verbose logging must be enabled in the system's plan in Jamf Protect
- [x] Python3 (see [requirements.txt](./requirements.txt))

## Getting Started

1. Clone JamfProtect GitHub repo

    `git clone https://github.com/jamf/jamfprotect.git`

2. Goto Jamf Protect Event Analysis folder

    `cd jamfprotect/helper_tools/jamf_protect_event_analysis`

3. Create a python virtual environment

    `python3 -m venv ~/Documents/py3-jp`

4. Activate python virtual environment

    `source ~/Documents/py3-jp/bin/activate`

5. Install Python3 requirements

    `pip3 install -r requirements.txt`

## How To

```
./jp_event_analysis.py -h
usage: jp_event_analysis.py [-h] -m MONITOR [-i INPUT] [-o OUTPUT] [-s]

Given a monitor, count events in Unified Logs.

optional arguments:
  -h, --help            show this help message and exit
  -m MONITOR, --monitor MONITOR
                        monitor Name to be used when parsing the logs
  -i INPUT, --input INPUT
                        path to JSON file to be parsed
  -o OUTPUT, --output OUTPUT
                        path to save xlsx
  -s, --summary         print summary
```

> **Note** 
> Only one monitor can be parsed at a time.

For this script you can either read the output of log show/stream results or the script will run a log stream for 60 seconds. If you are inputting from external results you must run the following on the machine when gathering the log file:

```
log stream --info --debug --style json --timeout <desired time> --predicate 'subsystem BEGINSWITH "com.jamf.protect" AND category == "<MonitorName>"' > log_file.json
```

## Self Service

Included is a [shell script](./jp_event_analysis_self_service.sh) which can be uploaded to Jamf Pro and run from Self Service. This script does the following in a temporary folder:

- Creates jp_event_analysis.py 
- Configures python virtual environment
- Gathers logs from the following monitors
    - Exec_Auth
    - Process
    - File
    - Unified Logging
- Archives the logs
- Cleans up

## Please note that all resources contained within this repository are provided as-is and are not officially supported by Jamf Support.
