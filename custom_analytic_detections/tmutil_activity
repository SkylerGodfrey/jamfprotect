# tmutil_activity
#
# This Analytic predicate may be used to report when tmutil is being used outside an interactive command line to either delete all local snapshots using the deletelocalsnapshots argument with / as mount point or the delete argument is used to delete a Time Machine backup from an external volume. An adversary may perform this action before launching a ransonware attack to prevent the victim from restoring their files.

# Required Analytic Configuration:
Sensor Event Type: Process Event
Level: 0

# Analytic Predicate:

$event.process.signingInfo.appid == "com.apple.timemachine.tmutil" AND
$event.type == 1 AND
$event.process.tty == nil AND
(($event.process.commandLine CONTAINS[c] "deletelocalsnapshots" AND $event.process.commandLine CONTAINS "/") OR ($event.process.commandLine CONTAINS[c] "delete"))

# Recommended Analytic Configuration:
Severity: Informational
Categories: Visibility, Living Off the Land